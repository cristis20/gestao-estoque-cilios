<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Estoque</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #ffeef5;
    margin: 0;
    padding: 20px;
  }
  h1 {
    color: #b03060;
    text-align: center;
  }
  .container {
    max-width: 900px;
    margin: 0 auto;
    background: white;
    border: 3px solid #f5b5c5;
    border-radius: 12px;
    padding: 20px;
  }
  .inputs {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 10px;
  }
  input, select, button {
    padding: 8px;
    border: 1px solid #f5b5c5;
    border-radius: 8px;
    font-size: 14px;
  }
  input {
    flex: 1;
    min-width: 120px;
  }
  button {
    background-color: #f7a8b8;
    color: white;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover {
    background-color: #b03060;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #f5b5c5;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #fddde6;
  }
  tfoot td {
    font-weight: bold;
  }
  footer {
    text-align: center;
    margin-top: 25px;
    padding: 10px;
    color: #b03060;
    font-size: 13px;
  }
  @media (max-width: 600px) {
    .inputs {
      flex-direction: column;
    }
    button {
      width: 100%;
    }
  }
</style>
</head>
<body>

<h1>Controle de Estoque</h1>

<div class="container">
  <div class="inputs">
    <input type="text" id="codigo" placeholder="Código do Produto">
    <input type="text" id="produto" placeholder="Produto">
    <input type="number" id="estoqueAtual" placeholder="Estoque Atual">
    <input type="number" id="estoqueIdeal" placeholder="Estoque Ideal">
    <input type="number" id="preco" placeholder="Preço (R$)" step="0.01">
    <button onclick="adicionar()">Adicionar</button>
    <button onclick="limparTudo()">Limpar Tudo</button>
    <button onclick="baixarExcel()">Baixar Excel</button>
    <select id="filtro" onchange="filtrarTabela()">
      <option value="todos">Todos</option>
      <option value="comprar">A Comprar</option>
      <option value="ok">OK</option>
    </select>
  </div>

  <table id="tabela">
    <thead>
      <tr>
        <th>Código</th>
        <th>Produto</th>
        <th>Estoque Atual</th>
        <th>Estoque Ideal</th>
        <th>Preço (R$)</th>
        <th>Qtd Comprar</th>
        <th>Valor Total (R$)</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr>
        <td colspan="6">Total Geral</td>
        <td id="totalGeral">R$ 0,00</td>
      </tr>
    </tfoot>
  </table>
</div>

<footer>
  Versão 1.0.1 - Atualizado em 07/11/25
</footer>

<script>
let produtos = JSON.parse(localStorage.getItem('produtos')) || [];

function salvar() {
  localStorage.setItem('produtos', JSON.stringify(produtos));
}

function formatarPreco(valor) {
  return "R$ " + (Number(valor).toFixed(2)).replace('.', ',');
}

function atualizarTabela(lista = produtos) {
  const tbody = document.querySelector("#tabela tbody");
  tbody.innerHTML = "";
  let totalGeral = 0;
  lista.forEach(p => {
    const tr = document.createElement("tr");
    const qtdComprar = Math.max(p.estoqueIdeal - p.estoqueAtual, 0);
    const valorTotal = qtdComprar * p.preco;
    totalGeral += valorTotal;
    tr.innerHTML = `
      <td onclick="selecionar('${p.codigo}')">${p.codigo}</td>
      <td>${p.produto}</td>
      <td>${p.estoqueAtual}</td>
      <td>${p.estoqueIdeal}</td>
      <td>${formatarPreco(p.preco)}</td>
      <td>${qtdComprar}</td>
      <td>${formatarPreco(valorTotal)}</td>
    `;
    tbody.appendChild(tr);
  });
  document.getElementById("totalGeral").textContent = formatarPreco(totalGeral);
}

function adicionar() {
  const codigo = document.getElementById("codigo").value.trim();
  const produto = document.getElementById("produto").value.trim();
  const estoqueAtual = Number(document.getElementById("estoqueAtual").value);
  const estoqueIdeal = Number(document.getElementById("estoqueIdeal").value);
  const preco = Number(document.getElementById("preco").value);

  if (!codigo || !produto) return alert("Preencha código e produto.");
  if (produtos.some(p => p.codigo === codigo)) return alert("Código já existe.");

  produtos.push({ codigo, produto, estoqueAtual, estoqueIdeal, preco });
  salvar();
  atualizarTabela();
  limparCampos();
}

function limparCampos() {
  document.getElementById("codigo").value = "";
  document.getElementById("produto").value = "";
  document.getElementById("estoqueAtual").value = "";
  document.getElementById("estoqueIdeal").value = "";
  document.getElementById("preco").value = "";
}

function limparTudo() {
  if (confirm("Deseja realmente limpar todos os dados?")) {
    produtos = [];
    salvar();
    atualizarTabela();
  }
}

function selecionar(codigo) {
  const item = produtos.find(p => p.codigo === codigo);
  if (!item) return;
  document.getElementById("codigo").value = item.codigo;
  document.getElementById("produto").value = item.produto;
  document.getElementById("estoqueAtual").value = item.estoqueAtual;
  document.getElementById("estoqueIdeal").value = item.estoqueIdeal;
  document.getElementById("preco").value = item.preco;
}

document.getElementById("codigo").addEventListener("change", () => {
  const codigo = document.getElementById("codigo").value.trim();
  const existente = produtos.find(p => p.codigo === codigo);
  if (existente) {
    selecionar(codigo);
    alert("Código já existe. Dados carregados.");
  }
});

function filtrarTabela() {
  const filtro = document.getElementById("filtro").value;
  let listaFiltrada = [];
  if (filtro === "todos") listaFiltrada = produtos;
  else if (filtro === "comprar") listaFiltrada = produtos.filter(p => p.estoqueAtual < p.estoqueIdeal);
  else if (filtro === "ok") listaFiltrada = produtos.filter(p => p.estoqueAtual >= p.estoqueIdeal);
  atualizarTabela(listaFiltrada);
}

function baixarExcel() {
  let csv = "Código,Produto,Estoque Atual,Estoque Ideal,Preço (R$),Qtd Comprar,Valor Total (R$)\n";
  produtos.forEach(p => {
    const qtd = Math.max(p.estoqueIdeal - p.estoqueAtual, 0);
    const valor = qtd * p.preco;
    csv += `${p.codigo},${p.produto},${p.estoqueAtual},${p.estoqueIdeal},${p.preco.toFixed(2)},${qtd},${valor.toFixed(2)}\n`;
  });
  const blob = new Blob([csv], { type: "text/csv" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "controle_estoque.csv";
  link.click();
}

window.addEventListener("load", () => atualizarTabela());
</script>

</body>
</html>
