<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestão de Estoque</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FFB6C1">

  <!-- Biblioteca SheetJS para gerar Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- Ícone iPhone -->
  <link rel="apple-touch-icon" sizes="180x180" href="icon-512.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    body { 
      font-family: Arial, sans-serif; 
      background: #ffe6f0; /* rosa suave */
      margin: 0; 
      padding: 20px; 
      overflow-x: hidden; 
    }

    h1 { 
      text-align: center; 
      color: #d6336c; /* rosa mais forte */
    }

    .container { 
      max-width: 950px; 
      width: 100%; 
      margin: 0 auto; 
      background: #fff0f6; /* rosa clarinho para o container */
      padding: 20px; 
      border-radius: 15px; 
      box-shadow: 0 0 15px rgba(198, 77, 123, 0.3); /* sombra suave rosa */
    }

    input, button, select { 
      display: block; 
      width: 100%; 
      padding: 10px; 
      margin-bottom: 10px; 
      box-sizing: border-box; 
      border-radius: 8px;
      border: 1px solid #ffc0cb; /* borda rosa suave */
    }

    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 20px; 
      background: #fff; 
      border-radius: 10px;
      overflow: hidden;
    }

    th, td { 
      border: 1px solid #f5c6d0; 
      padding: 12px; 
      text-align: center; 
    }

    th { 
      background-color: #ffc0cb; /* rosa médio para o cabeçalho */
      color: #800040;
    }

    .btn { 
      cursor: pointer; 
      border: none; 
      border-radius: 8px; 
      padding: 10px 15px; 
      font-weight: bold;
      transition: 0.3s;
    }

    .btn:hover { opacity: 0.9; }

    .add { background: #ff69b4; color: white; } /* rosa vibrante */
    .edit { background: #ff85c1; color: white; } /* rosa claro */
    .delete { background: #ff4d6d; color: white; } /* vermelho-rosado */
    .clear { background: #c71585; color: white; float: right; }

    .verde { background-color: #d4f0dc; }    /* verde suave */
    .amarelo { background-color: #fff0b3; }  /* amarelo suave */
    .vermelho { background-color: #ffc1c1; } /* vermelho suave */

    select { background-color: #ffe6f0; color: #800040; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Gestão de Estoque</h1>

    <label>Produto:</label>
    <input type="text" id="produto" maxlength="20" placeholder="Nome do produto">
    <label>Descrição:</label>
    <input type="text" id="descricao" maxlength="20" placeholder="Descrição (máx 20 caracteres)">
    <label>Estoque Atual:</label>
    <input type="number" id="estoqueAtual" step="1" min="0">
    <label>Estoque Ideal:</label>
    <input type="number" id="estoqueIdeal" step="1" min="0">

    <button class="btn add" onclick="adicionarProduto()">Adicionar</button>
    <button class="btn clear" onclick="limparTudo()">Limpar Tudo</button>
    <button class="btn" onclick="baixarExcel()">Baixar Excel</button>

    <label>Filtrar produtos:</label>
    <select id="filtro" onchange="atualizarTabela()">
      <option value="todos">Todos</option>
      <option value="comprar">Só Precisa Comprar</option>
      <option value="ok">Só OK</option>
    </select>

    <table id="tabela">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Descrição</th>
          <th>Estoque Atual</th>
          <th>Estoque Ideal</th>
          <th>Quantidade a Comprar</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations){
        for(let registration of registrations) { registration.unregister(); }
      });
    }

    let produtos = JSON.parse(localStorage.getItem('produtos')) || [];
    let editIndex = null;

    function salvar() { localStorage.setItem('produtos', JSON.stringify(produtos)); atualizarTabela(); }

    function adicionarProduto() {
      const produto = document.getElementById('produto').value.trim();
      const descricao = document.getElementById('descricao').value.trim();
      const estoqueAtual = parseInt(document.getElementById('estoqueAtual').value);
      const estoqueIdeal = parseInt(document.getElementById('estoqueIdeal').value);
      if (!produto || isNaN(estoqueAtual) || isNaN(estoqueIdeal)) { alert('Preencha todos os campos!'); return; }
      const novoProduto = { produto, descricao, estoqueAtual, estoqueIdeal };
      if (editIndex !== null) { produtos[editIndex] = novoProduto; editIndex = null; } else { produtos.push(novoProduto); }
      salvar(); limparCampos();
    }

    function editarProduto(index) {
      const p = produtos[index];
      document.getElementById('produto').value = p.produto;
      document.getElementById('descricao').value = p.descricao;
      document.getElementById('estoqueAtual').value = p.estoqueAtual;
      document.getElementById('estoqueIdeal').value = p.estoqueIdeal;
      editIndex = index;
    }

    function excluirProduto(index) { if(confirm('Deseja excluir este produto?')) { produtos.splice(index, 1); salvar(); } }

    function limparCampos() {
      document.getElementById('produto').value='';
      document.getElementById('descricao').value='';
      document.getElementById('estoqueAtual').value='';
      document.getElementById('estoqueIdeal').value='';
    }

    function limparTudo() { if(confirm('Tem certeza que deseja apagar todos os produtos?')) { produtos = []; salvar(); } }

    function corLinha(p) { if(p.estoqueAtual<p.estoqueIdeal)return'vermelho'; if(p.estoqueAtual===p.estoqueIdeal)return'amarelo'; return'verde'; }

    function atualizarTabela() {
      const tbody=document.querySelector('#tabela tbody'); tbody.innerHTML='';
      const filtro = document.getElementById('filtro').value;
      produtos.forEach((p,index)=>{
        const quantidadeComprar = p.estoqueAtual < p.estoqueIdeal ? (p.estoqueIdeal - p.estoqueAtual) : 0;
        if(filtro==='comprar' && quantidadeComprar<=0) return;
        if(filtro==='ok' && quantidadeComprar>0) return;
        const tr=document.createElement('tr'); tr.className=corLinha(p);
        tr.innerHTML=`
          <td>${p.produto}</td>
          <td>${p.descricao}</td>
          <td>${p.estoqueAtual}</td>
          <td>${p.estoqueIdeal}</td>
          <td class='${quantidadeComprar>0?'vermelho':''}'>${quantidadeComprar}</td>
          <td>${quantidadeComprar>0?'Comprar':'OK'}</td>
          <td>
            <button class='btn edit' onclick='editarProduto(${index})'>Editar</button>
            <button class='btn delete' onclick='excluirProduto(${index})'>Excluir</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function baixarExcel() {
      if (produtos.length === 0) { alert('Não há produtos para baixar!'); return; }

      const dados = produtos.map(p => {
        const quantidadeComprar = p.estoqueAtual < p.estoqueIdeal ? (p.estoqueIdeal - p.estoqueAtual) : 0;
        return {
          'Produto': p.produto,
          'Descrição': p.descricao,
          'Estoque Atual': p.estoqueAtual,
          'Estoque Ideal': p.estoqueIdeal,
          'Quantidade a Comprar': quantidadeComprar,
          'Status': quantidadeComprar>0?'Comprar':'OK'
        };
      });

      const ws = XLSX.utils.json_to_sheet(dados);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Estoque');
      XLSX.writeFile(wb, 'estoque.xlsx');
    }

    atualizarTabela();
  </script>
</body>
</html>
